! NOTE (AK): ./test_legolas -f mod_test_initial_condition
module mod_test_initial_condition
  use mod_suite_utils
  use funit
  use mod_logging, only: str, logger
  use mod_initial_condition, only: generate_ic, reconstruct_profiles
  implicit none

contains

  @before
  subroutine init_test()
    call reset_globals()
    call logger%set_logging_level(3)
  end subroutine init_test


  @after
  subroutine tear_down()
    call logger%set_logging_level(TEST_LOG_LVL)
  end subroutine tear_down


  @test
  subroutine test_ic_assembly()
    integer :: i
    integer :: N
    real(dp) :: x0(6*11)
    real(dp) :: nodes(11)

    N = 11

    call set_name("initial condition test")

    nodes = [ (i, i=-5,5) ]
    x0 = 0.0d0

    call generate_ic(N, nodes, x0)
    call logger%info('x0' // str(x0))

    @assertEqual(1.0, 1.0)
  end subroutine test_ic_assembly

  @test
  subroutine test_reconstruct_profiles()
    integer, parameter :: N = 11
    integer, parameter  :: N_fine = 200
    real(dp) :: x(6*N)
    real(dp) :: nodes(N)
    real(dp) :: x_fine(N_fine)
    real(dp) :: rho(N_fine), v1(N_fine), T(N_fine)
    integer :: i

    call set_name("reconstruct profiles test")

    nodes = [ (i, i=-5,5) ]
    x_fine = linspace(-5.0d0, 5.0d0, 200)

    ! Gaussian for all profiles
    x = [0.00000000, 0.00000149, 0.00000149, 0.00000743, 0.00000000, 0.00000149, 0.00001598, 0.00013383, 0.00013383,  &
         0.00053532, 0.00001598, 0.00013383, 0.00087268, 0.00443185, 0.00443185, 0.01329555, 0.00087268, 0.00443185,  &
        0.01752830, 0.05399097, 0.05399097, 0.10798193, 0.01752830, 0.05399097, 0.12951760, 0.24197072, 0.24197072,   &
        0.24197072, 0.12951760, 0.24197072, 0.35206533, 0.39894228, 0.39894228, -0.00000000, 0.35206533, 0.39894228,  &
        0.35206533, 0.24197072, 0.24197072, -0.24197072, 0.35206533, 0.24197072, 0.12951760, 0.05399097, 0.05399097,  &
        -0.10798193, 0.12951760, 0.05399097, 0.01752830, 0.00443185, 0.00443185, -0.01329555, 0.01752830, 0.00443185, &
        0.00087268, 0.00013383, 0.00013383, -0.00053532, 0.00087268, 0.00013383, 0.00001598, 0.00000149, 0.00000149,  &
        -0.00000743, 0.00001598, 0.00000149]

    call reconstruct_profiles(N, nodes, N_fine, x_fine, x, rho, v1, T)
    call logger%info('rho' // str(rho))

    @assertEqual(1.0, 1.0)
  end subroutine test_reconstruct_profiles

end module mod_test_initial_condition